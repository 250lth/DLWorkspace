@{
    ViewData["Title"] = "View Your Submitted Job";
}

<h1>View Your Jobs:</h1>


<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.10.2.min.js" type="text/javascript"></script>
<script>
    function buildTable() {
        $.getJSON("@ViewData["restapi"]/ListJobs",
        function (json) {
            $("#running-job-table").find("tr:gt(0)").remove();
            var tr;
            //Append each row to html table
            for (var i = 0; i < json.runningJobs.length; i++) {
                tr = $('<tr/>');
                tr.append("<td>" + json.runningJobs[i].job_id + "</td>");
                tr.append("<td>" + json.runningJobs[i].job_name + "</td>");
                tr.append("<td>" + json.runningJobs[i].status + "</td>");
                tr.append("<td>" + json.runningJobs[i].time.toString("YYYYMMDD") + "</td>");
                tr.append("<td> <a href='/Home/JobLog/?jobId=" + json.runningJobs[i].job_id + "'> log </a></td>");
                tr.append("<td> <a href='/Home/KillJob/?jobId=" + json.runningJobs[i].job_id + "'> kill </a></td>");
                $('#running-job-table').append(tr);
            }

            $("#finished-job-table").find("tr:gt(0)").remove();
            if (json.finishedJobs.length <= 0) {
                $('#finished-job').hide();
            }
            else {
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.finishedJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td>" + json.finishedJobs[i].job_id + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].job_name + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].status + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].time + "</td>");
                    tr.append("<td> <a href='/Home/JobLog/?jobId=" + json.runningJobs[i].job_id + "'> log </a></td>");
                    $('#finished-job-table').append(tr);
                }
            }


            $("#queued-job-table").find("tr:gt(0)").remove();
            if (json.queuedJobs.length <= 0) {
                $('#queued-job').hide();

            }
            else {
                $('#queued-job').show()
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.queuedJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td>" + json.queuedJobs[i].job_id + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].job_name + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].status + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].time + "</td>");
                    tr.append("<td> <a href='/Home/KillJob/?jobId=" + json.runningJobs[i].job_id + "'> kill </a></td>");
                    $('#queued-job-table').append(tr);
                }
            }


            $("#interactive-job-table").find("tr:gt(0)").remove();
            if (json.interactiveJobs.length <= 0) {
                $('#interactive-job').hide();

            }
            else {
                $('#queued-job').show()
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.interactiveJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td>" + json.interactiveJobs[i].job_id + "</td>");
                    tr.append("<td>" + json.interactiveJobs[i].job_name + "</td>");
                    tr.append("<td>" + json.interactiveJobs[i].status + "</td>");
                    tr.append("<td>" + json.interactiveJobs[i].time + "</td>");
                    tr.append("<td> <a href='/Home/JobLog/?jobId=" + json.runningJobs[i].job_id + "'> log </a></td>");
                    tr.append("<td> <a href='/Home/KillJob/?jobId=" + json.runningJobs[i].job_id + "'> kill </a></td>");
                    $('#interactive-job-table').append(tr);
                }
            }

            $("#visualization-job-table").find("tr:gt(0)").remove();
            if (json.visualizationJobs.length <= 0) {
                $('#visualization-job').hide();
            }
            else {
                $('#queued-job').show()
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.visualizationJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td>" + json.visualizationJobs[i].job_id + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].job_name + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].status + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].time.toString("YYYYMMDD") + "</td>");
                    tr.append("<td> <a href='/Home/JobLog/?jobId=" + json.runningJobs[i].job_id + "'> log </a></td>");
                    tr.append("<td> <a href='/Home/KillJob/?jobId=" + json.runningJobs[i].job_id + "'> kill </a></td>");
                    $('#visualization-job-table').append(tr);
                }
            }

        });
    }

    $(document).ready(function () {


        var refresh = setInterval(function () {
            buildTable();
        }, 1000);
    });

</script>

<div id="queued-job" hidden>
    <p> <b>Queued Jobs</b></p>
    <table id="queued-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>Job Submission Time</th>
                <th>Kill it</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<p> <b>Running Jobs</b></p>
<table id="running-job-table" class="table table-bordered table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th>Job Id</th>
            <th>Job Name</th>
            <th>Status</th>
            <th>Job Submission Time</th>
            <th>Console logs</th>
            <th>Kill it</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="interactive-job" hidden>
    <p> <b>Interactive Jobs</b></p>
    <table id="interactive-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>Job Submission Time</th>
                <th>Console logs</th>
                <th>Kill it</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div id="visualization-job" hidden>
    <p> <b>Visualizations</b></p>
    <table id="visualization-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>Job Submission Time</th>
                <th>Console logs</th>
                <th>Kill it</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>



<div id="finished-job" hidden>

    <p> <b>Finished Jobs</b></p>
    <table id="finished-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>Job Submission Time</th>
                <th>Console logs</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
